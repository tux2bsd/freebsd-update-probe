# freebsd-update-probe.sh

```
A "tag" is stored on disk, it is generated by /usr/sbin/freebsd-update
and it is authoritive.  freebsd-update-probe.sh tests for a match between
the current tag and the upstream tag, this test is quick and can be used
to determine if updates are required.

freebsd-update-probe.sh provides a work around for FreeBSD bug:
  https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=258863

freebsd-update-probe.sh hugely benefits IO bound hardware, see below.
```

# Usage
```
No arguments.  Example usage:
freebsd-update-probe.sh || freebsd-update fetch [install]
  or you could
freebsd-update-probe.sh || mail_sysadmin_to_manually_update
* if /usr/sbin/freebsd-update exit code !=0 be sure to run that manually
  until does exit 0 because the tag assessed by freebsd-update-probe.sh
  is produced by /usr/sbin/freebsd-update
* untested inside FreeBSD Jail environments
* Written/tested on FreeBSD 13.0 (12.2 reported working)
Version: 20220331 ### https://github.com/tux2bsd/freebsd-update-probe 
```

# Exit codes
```
exit 0, PASS, no freebsd-update needed.
exit 1, FAIL, freebsd-update suggested.
```

# Deploy examples:
```
fetch https://raw.githubusercontent.com/tux2bsd/freebsd-update-probe/main/freebsd-update-probe.sh -o /usr/local/bin/freebsd-update-probe.sh
chmod 700 /usr/local/bin/freebsd-update-probe.sh
# Or
fetch https://raw.githubusercontent.com/tux2bsd/freebsd-update-probe/main/freebsd-update-probe.sh -o freebsd-update-probe.sh
scp freebsd-update-probe.sh root@server.example.com:/usr/local/bin/
ssh root@server.example.com "chmod 700 /usr/local/bin/freebsd-update-probe.sh"
```

# Before (on Raspberry Pi 3B): 1m32s

```
# date ; time freebsd-update fetch install ; date
Sat Mar 26 08:41:00 NZDT 2022
src component not installed, skipped
Looking up update.FreeBSD.org mirrors... 2 mirrors found.
Fetching metadata signature for 13.0-RELEASE from update1.freebsd.org... done.
Fetching metadata index... done.
Inspecting system... done.
Preparing to download files... done.

No updates needed to update system to 13.0-RELEASE-p10.
No updates are available to install.
76.646u 22.863s 1:32.08 108.0%  22+170k 0+0io 0pf+0w
Sat Mar 26 08:42:32 NZDT 2022
```

# After (on Raspberry Pi 3B): sub 1s

```
# date ; time /root/freebsd-update-probe.sh || freebsd-update fetch install ; date
Sat Mar 26 08:43:48 NZDT 2022
probe tag file: PASS, no freebsd-update needed.
0.095u 0.103s 0:00.51 37.2%     96+171k 0+0io 0pf+0w
Sat Mar 26 08:43:48 NZDT 2022
```

